{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\amal9\\\\Desktop\\\\ReactProject\\\\chatapp\\\\src\\\\components\\\\Searchbar.jsx\",\n  _s = $RefreshSig$();\nimport React, { useContext, useState } from \"react\";\nimport { collection, query, where, getDocs, setDoc, doc, updateDoc, serverTimestamp, getDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport { AuthContext } from \"../context/AuthContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Search = () => {\n  _s();\n  const [username, setUsername] = useState(\"\");\n  const [user, setUser] = useState(null);\n  const [err, setErr] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const handleSearch = async () => {\n    const q = query(collection(db, \"users\"), where(\"displayName\", \"==\", username));\n    try {\n      const querySnapshot = await getDocs(q);\n      if (querySnapshot.empty) {\n        setErr(true); // Set error if no matching user found\n      } else {\n        setErr(false); // Reset error if user is found\n        querySnapshot.forEach(doc => {\n          setUser(doc.data());\n        });\n      }\n    } catch (err) {\n      setErr(true); // Set error if there's an error fetching data\n    }\n  };\n  const handleKey = e => {\n    e.code === \"Enter\" && handleSearch();\n  };\n  const handleSelect = async () => {\n    //check whether the group(chats in firestore) exists, if not create\n    //if the current user id is bigger than user uid combine current user id +user id\n    const combinedId = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n    try {\n      const res = await getDocs(db, \"chats\", combinedId);\n      //create a chat in chats collection\n      await setDoc(doc(db, \"chats\", combinedId), {\n        messages: []\n      });\n      //create user chats\n      await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n        [combinedId + \".userInfo\"]: {\n          uid: user.uid,\n          displayName: user.displayName,\n          photoURL: user.photoURL\n        },\n        [combinedId + \".date\"]: serverTimestamp()\n      });\n      await updateDoc(doc(db, \"userChats\", user.uid), {\n        [combinedId + \".userInfo\"]: {\n          uid: currentUser.uid,\n          displayName: currentUser.displayName,\n          photoURL: currentUser.photoURL\n        },\n        [combinedId + \".date\"]: serverTimestamp()\n      });\n    } catch (error) {}\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"searchForm\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Find a user\",\n          onKeyDown: handleKey,\n          onChange: e => setUsername(e.target.value),\n          value: username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), err && /*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"User not found \\uD83D\\uDE22 \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 17\n      }, this), user && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userChat\",\n        onClick: handleSelect,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: \"flex\",\n            alignItems: \"center\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: user.photoURL,\n            alt: \"\",\n            style: {\n              height: \"50px\",\n              width: \"50px\",\n              objectFit: \"cover\",\n              borderRadius: \"50%\",\n              marginRight: \"10px\" // Add margin to create space between image and name\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"userChatInfo\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              children: user.displayName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this);\n  };\n};\n_s(Search, \"ZXQzUE3EguMIuY/UQNcA26iC/M4=\");\n_c = Search;\nexport default Search;\nvar _c;\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"names":["React","useContext","useState","collection","query","where","getDocs","setDoc","doc","updateDoc","serverTimestamp","getDoc","db","AuthContext","jsxDEV","_jsxDEV","Search","_s","username","setUsername","user","setUser","err","setErr","currentUser","handleSearch","q","querySnapshot","empty","forEach","data","handleKey","e","code","handleSelect","combinedId","uid","res","messages","displayName","photoURL","error","className","children","type","placeholder","onKeyDown","onChange","target","value","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","display","alignItems","src","alt","height","width","objectFit","borderRadius","marginRight","_c","$RefreshReg$"],"sources":["C:/Users/amal9/Desktop/ReactProject/chatapp/src/components/Searchbar.jsx"],"sourcesContent":["import React, { useContext, useState } from \"react\";\r\nimport {\r\n  collection,\r\n  query,\r\n  where,\r\n  getDocs,\r\n  setDoc,\r\n  doc,\r\n  updateDoc,\r\n  serverTimestamp,\r\n  getDoc,\r\n} from \"firebase/firestore\";\r\n\r\nimport { db } from \"../firebase\";\r\nimport { AuthContext } from \"../context/AuthContext\";\r\n\r\nconst Search = () => {\r\n  const [username, setUsername] = useState(\"\");\r\n  const [user, setUser] = useState(null);\r\n  const [err, setErr] = useState(false);\r\n\r\n  const { currentUser } = useContext(AuthContext);\r\n\r\n  const handleSearch = async () => {\r\n    const q = query(\r\n      collection(db, \"users\"),\r\n      where(\"displayName\", \"==\", username)\r\n    );\r\n\r\n    try {\r\n      const querySnapshot = await getDocs(q);\r\n\r\n      if (querySnapshot.empty) {\r\n        setErr(true); // Set error if no matching user found\r\n      } else {\r\n        setErr(false); // Reset error if user is found\r\n        querySnapshot.forEach((doc) => {\r\n          setUser(doc.data());\r\n        });\r\n      }\r\n    } catch (err) {\r\n      setErr(true); // Set error if there's an error fetching data\r\n    }\r\n  };\r\n\r\n  const handleKey = (e) => {\r\n    e.code === \"Enter\" && handleSearch();\r\n  };\r\n\r\n  const handleSelect = async () => {\r\n    //check whether the group(chats in firestore) exists, if not create\r\n    //if the current user id is bigger than user uid combine current user id +user id\r\n    const combinedId =\r\n      currentUser.uid > user.uid\r\n        ? currentUser.uid + user.uid\r\n        : user.uid + currentUser.uid;\r\n    try {\r\n      const res = await getDocs(db, \"chats\", combinedId);\r\n      //create a chat in chats collection\r\n      await setDoc(doc(db, \"chats\", combinedId), { messages: [] });\r\n      //create user chats\r\n      await updateDoc(doc(db, \"userChats\", currentUser.uid), {\r\n        [combinedId + \".userInfo\"]: {\r\n          uid: user.uid,\r\n          displayName: user.displayName,\r\n          photoURL: user.photoURL,\r\n        },\r\n        [combinedId + \".date\"]: serverTimestamp(),\r\n      });\r\n\r\n      await updateDoc(doc(db, \"userChats\", user.uid), {\r\n        [combinedId + \".userInfo\"]: {\r\n          uid: currentUser.uid,\r\n          displayName: currentUser.displayName,\r\n          photoURL: currentUser.photoURL,\r\n        },\r\n        [combinedId + \".date\"]: serverTimestamp(),\r\n      });\r\n    } catch (error) {}\r\n\r\n    return (\r\n      <div className=\"search\">\r\n        <div className=\"searchForm\">\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Find a user\"\r\n            onKeyDown={handleKey}\r\n            onChange={(e) => setUsername(e.target.value)}\r\n            value={username}\r\n          />\r\n        </div>\r\n        {err && <span>User not found ðŸ˜¢ </span>}\r\n        {user && (\r\n          <div className=\"userChat\" onClick={handleSelect}>\r\n            <div style={{ display: \"flex\", alignItems: \"center\" }}>\r\n              <img\r\n                src={user.photoURL}\r\n                alt=\"\"\r\n                style={{\r\n                  height: \"50px\",\r\n                  width: \"50px\",\r\n                  objectFit: \"cover\",\r\n                  borderRadius: \"50%\",\r\n                  marginRight: \"10px\", // Add margin to create space between image and name\r\n                }}\r\n              />\r\n              <div className=\"userChatInfo\">\r\n                <span>{user.displayName}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n};\r\n\r\nexport default Search;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}